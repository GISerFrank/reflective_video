# backend/app/main.py - ä¿®å¤ç‰ˆæœ¬
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

# åˆ›å»ºFastAPIåº”ç”¨
app = FastAPI(
    title="Smart Video Platform",
    description="æ™ºèƒ½è§†é¢‘å­¦ä¹ å¹³å° - é›†æˆç›¸ä¼¼åº¦æ£€æµ‹å’Œè´¨é‡è¯„ä¼°çš„è§‚åæ„Ÿç³»ç»Ÿ",
    version="1.0.0"
)

# CORSä¸­é—´ä»¶é…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ç”Ÿäº§ç¯å¢ƒä¸­åº”è¯¥è®¾ç½®å…·ä½“çš„åŸŸå
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# åŸºç¡€è·¯ç”±
@app.get("/")
async def root():
    return {
        "message": "æ¬¢è¿ä½¿ç”¨Smart Video Platform API",
        "version": "1.0.0",
        "docs": "/docs"
    }

@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "message": "Smart Video Platform APIè¿è¡Œæ­£å¸¸"
    }

# æ¡ä»¶å¯¼å…¥å’Œæ³¨å†Œè·¯ç”± - é¿å…å¯¼å…¥é”™è¯¯
try:
    from .routes import videos
    app.include_router(videos.router, prefix="/api/videos", tags=["videos"])
    print("âœ… Videosè·¯ç”±æ³¨å†ŒæˆåŠŸ")
except ImportError as e:
    print(f"âŒ Videosè·¯ç”±å¯¼å…¥å¤±è´¥: {e}")

try:
    from .routes import comments
    app.include_router(comments.router, prefix="/api/comments", tags=["comments"])
    print("âœ… Commentsè·¯ç”±æ³¨å†ŒæˆåŠŸ")
except ImportError as e:
    print(f"âŒ Commentsè·¯ç”±å¯¼å…¥å¤±è´¥: {e}")

try:
    from .routes import reflections
    app.include_router(reflections.router, prefix="/api/reflections", tags=["reflections"])
    print("âœ… Reflectionsè·¯ç”±æ³¨å†ŒæˆåŠŸ")
except ImportError as e:
    print(f"âŒ Reflectionsè·¯ç”±å¯¼å…¥å¤±è´¥: {e}")

# å¯åŠ¨äº‹ä»¶
@app.on_event("startup")
async def startup_event():
    print("ğŸš€ Smart Video Platform APIå¯åŠ¨å®Œæˆ")
    print("ğŸ“– APIæ–‡æ¡£: http://127.0.0.1:8000/docs")

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
